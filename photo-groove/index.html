<!doctype html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://elm-in-action.com/styles.css"/>
    <link rel="stylesheet" href="https://elm-in-action.com/range-slider.css"/>
    <script src="https://elm-in-action.com/range-slider.js"></script>
    <style>
      body {background-color : rgb(44, 44, 44); color: white; }
      img {border: 1px solid white; margin: 5px; }
      .large{width: 500px; float: right; }
      .selected{margin: 0; border: 6px solid #60b5cc; }
      .content {margin: 40px auto; width: 960px;}
      #thumbnails {width: 440px; float:left;}
      h1 {font-family: Verdana,serif; color: #60b5cc}
    </style>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Photo Groove</title>
    <script src="slider.js"></script>
</head>
<body>
    <div id="app"></div>
    <script src="https://elm-in-action.com/pasta.js"></script>
    <script src="app.js"></script>
    <script>
        /*
        The object app, lets us subscribe to data that Elm sends to JavaScript via ports like setFilters. When the Elm
        Runtime executes the Cmd returned by setFilters, the callback function we've passed to app.ports.setFilters.subscribe
        will run. The options argument it accepts is the FilterOptions record Elm set over, but converted from an Elm record
        to a JavaScript object.

        Because all Elm values must be immutable, mutable values (such as JavaScript objects and arrays) can't be sent
        through the port. Instead they automatically get copied into immutable data structures. This process has some
        overhead. Passing in values like strings and numbers, which are already immutable, has no such overhead.
         */
        const app = Elm.PhotoGroove.init({
            node: document.getElementById("app"),
            flags: Pasta.version
        });

        app.ports.setFilters.subscribe(function(options) {
            /*
                Synchronizing with the Elm Runtime
                The JavaScript function requestAnimationFrame allows code to run just before the browser's next repaint.
                Bacause this is when the Elm Runtime will schedule its next DOM update, we can use requestAnimationFrame
                to delay our call to document.getElementById("main-canvas")  until after our next view has added the <canvas>
                we need to the DOM.
             */
            requestAnimationFrame(function() {
                Pasta.apply(document.getElementById("main-canvas"), options);
            });
        });

        // Pasta calls this function whenever its activity changes.
        Pasta.addActivityListener(function(activity) {
            console.log("Got some activity to send to Elm: ", activity);
            app.ports.activityChanges.send(activity);
        })
    </script>
</body>
</html>